---
title: 12.centos系统安装containerd
date: 2023-03-28 16:45:03
tags:
- k8s
- containerd
categories:
- 技术
type: "tags"
---

# centos系统安装containerd

## 1.背景

Kubernetes 的早期版本仅适用于特定的容器运行时：Docker Engine。 后来，Kubernetes 增加了对使用其他容器运行时的支持。创建[CRI 标准](https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/) 是为了实现编排器（如 Kubernetes）和许多不同的容器运行时之间交互操作。 Docker Engine 没有实现（CRI）接口，因此 Kubernetes 项目创建了特殊代码来帮助过渡， 并使 dockershim 代码成为 Kubernetes 的一部分。

dockershim 代码一直是一个临时解决方案（因此得名：shim）。 你可以阅读 [Kubernetes 移除 Dockershim 增强方案](https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2221-remove-dockershim) 以了解相关的社区讨论和计划。 事实上，维护 dockershim 已经成为 Kubernetes 维护者的沉重负担。

此外，在较新的 CRI 运行时中实现了与 dockershim 不兼容的功能，例如 cgroups v2 和用户命名空间。 从 Kubernetes 中移除 dockershim 允许在这些领域进行进一步的开发。

Kubernetes 在 [v1.24 版](https://kubernetes.io/releases/#release-v1-24)正式移除了 dockershim。

<!--more-->

## 2.containerd运行时

[containerd](https://github.com/containerd/containerd)作为CNCF社区毕业的运行时项目，在k8s移除dockershim的背景下，有必要了解containerd的安装和基本使用。

### 2.1.containerd安装

```bash
# 1.安装依赖
 
yum install -y yum-utils device-mapper-persistent-data lvm2
 
# 2.添加yum源
 
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
 
# 3.安装containerd
 
yum install containerd -y
 
# 4.生成配置文件
 
containerd config default > /etc/containerd/config.toml
 
# 5.替换 containerd 默认的 sand_box 镜像，编辑 /etc/containerd/config.toml
 
sandbox_image = "registry.aliyuncs.com/google_containers/pause:3.2"
 
# 6.启动服务
 
systemctl restart containerd && systemctl enable containerd
```

