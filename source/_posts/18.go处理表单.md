---
title: go处理表单
type: tags
date: 2023-12-26 18:10:01
tags:
- go
- web
categories:
- 学习笔记
---

## go处理表单

### 1.处理表单输入

前端样例：

```html
<!DOCTYPE html>
<body>
    <form action="http://127.0.0.1:8080/login" method="post">
        用户名：<input type="text" name="username">
        密码：<input type="password" name="password">
        <input type="submit" value="login">
    </form>
</body>
</html>
```

后端样例：

```go
package main

import (
	"fmt"
	"log"
	"net/http"
	"text/template"
)

func main() {
	http.HandleFunc("/login", login)
	err := http.ListenAndServe(":8080", nil)
	if err != nil {
		log.Fatal(err)
	}
}

func login(w http.ResponseWriter, r *http.Request) {
	if r.Method == "GET" {
		t, err := template.ParseFiles("./login.html")
		if err != nil {
			log.Fatal(err)
		}
		t.Execute(w, nil)
	} else {
        // 这一步必不可少，否则获取不到表单数据。
		r.ParseForm()
		for k, v := range r.Form {
			fmt.Println(k, "------", v)
		}

		fmt.Fprintf(w, "get login mesage.")
	}
}
```

### 2.处理文件上传

前端样例：

```html
<!DOCTYPE html>
<body>
    <form action="http://127.0.0.1:8080/upload" method="post" enctype="multipart/form-data">
        选择文件上传：<input type="file" name="upload">
        <input type="hidden" name="token" value={{.}}>
        <input type="submit" value="upload">
    </form>
</body>
</html>
```

后端样例：

```go
package main

import (
	"crypto/md5"
	"fmt"
	"io"
	"log"
	"net/http"
	"os"
	"text/template"
)

func main() {
	http.HandleFunc("/upload", upload)
	err := http.ListenAndServe(":8080", nil)
	if err != nil {
		log.Fatal(err)
	}
}

func upload(w http.ResponseWriter, r *http.Request) {
	if r.Method == "GET" {
		t, err := template.ParseFiles("./upload.html")
		if err != nil {
			log.Fatal(err)
		}

		h := md5.New()
		token := fmt.Sprintf("%x", h.Sum(nil))
		t.Execute(w, token)
	} else {
        // 读取上传文件的步骤
		r.ParseMultipartForm(32 << 20)
		f, fileHeader, err := r.FormFile("upload")
        
		if err != nil {
			log.Fatal(err)
		}
		defer f.Close()

		fmt.Fprintf(w, "get upload file.")
        // 在服务器端创建文件并保存
		file, err := os.OpenFile("./"+fileHeader.Filename, os.O_WRONLY|os.O_CREATE, 0666)
		if err != nil {
			log.Fatal(err)
		}
		defer file.Close()

		io.Copy(file, f)
	}
}
```

